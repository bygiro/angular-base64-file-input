angular.module("ByGiro.base64FileInput",[]).directive("base64Input",["$window","$parse",function(e){return{restrict:"A",scope:{dataVal:"=?ngModel"},link:function(t,a){function n(t){for(var a="",n=new Uint8Array(t),i=n.byteLength,r=0;i>r;r++)a+=String.fromCharCode(n[r]);return e.btoa(a)}function i(){switch(preview="",this.previewType){case"image":preview="data:image/"+this.type+";base64,"+this.base64;break;case"text":preview=decodeURIComponent(escape(e.atob(this.base64)))}return preview}var r={},s=a[0],o=(s.matches||s.matchesSelector||s.msMatchesSelector||s.mozMatchesSelector||s.webkitMatchesSelector||s.oMatchesSelector).call(s,'input[type="file"]');if(o){var c=angular.element('<span class="btn btn-info">file</span>');c.on("click",function(){s.click()}),a.css({width:"1px",height:"1px",overflow:"hidden"}),a.after(c);var p=new FileReader;p.onload=function(e){switch(r.base64=n(e.target.result),r.previewType="",!0){case r.type.indexOf("image/")>=0:r.previewType="image";break;case r.type.indexOf("text/")>=0:r.previewType="text";break;default:r.previewType="extension"}var a=t.$root.$$phase;"$apply"==a||"$digest"==a?t.dataVal=r:t.$apply(function(){t.dataVal=r})},a.on("change",function(){var e=a[0].files[0];r.type=e.type,r.name=e.name,r.extension="",e.name.lastIndexOf(".")>=0&&(r.extension=e.name.substr(e.name.lastIndexOf(".")+1)),r.size=e.size,r.getPreview=i,p.readAsArrayBuffer(e)})}}}}]);